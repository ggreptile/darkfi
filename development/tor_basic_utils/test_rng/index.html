<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Code for deterministic and/or reproducible use of PRNGs in tests."><title>tor_basic_utils::test_rng - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="tor_basic_utils" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0-nightly (31395ec38 2023-07-24)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-6d2c9675f3d09c26.css" data-theme-dark-css="dark-45ceb8f2e522f4d1.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-6d2c9675f3d09c26.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-45ceb8f2e522f4d1.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../tor_basic_utils/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../tor_basic_utils/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module test_rng</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">tor_basic_utils</a>::<wbr><a class="mod" href="#">test_rng</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/tor_basic_utils/test_rng.rs.html#1-346">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Code for deterministic and/or reproducible use of PRNGs in tests.</p>
<p>Often in testing we want to test a random scenario, but we want to be sure
of our ability to reproduce the scenario if the test fails.</p>
<p>To achieve this,  just have your test use <a href="fn.testing_rng.html" title="fn tor_basic_utils::test_rng::testing_rng"><code>testing_rng()</code></a> in place of
<a href="../../rand/rngs/thread/fn.thread_rng.html" title="fn rand::rngs::thread::thread_rng"><code>rand::thread_rng()</code></a>.  Then the test will (by default) choose a new random
seed for every run, and print that seed to standard output.  If the test
fails, the seed will be displayed as part of the failure message, and you
will be able to use it to recreate the same PRNG seed as the one that caused
the failure.</p>
<p>If you’re running your tests in a situation where deterministic behavior is
key, you can also enable this via the environment.</p>
<p>The run-time behavior is controlled using the <code>ARTI_TEST_PRNG</code> variable; you
can set it to any of the following:</p>
<ul>
<li><code>random</code> for a randomly seeded PRNG. (This is the default).</li>
<li><code>deterministic</code> for an arbitrary seed that is the same on every run of
the program. (You can use this in cases where even a tiny chance of
stochastic behavior in your tests is unacceptable.)</li>
<li>A hexadecimal string, to specify a given seed to re-use from a previous
test run.</li>
</ul>
<h2 id="warning"><a href="#warning">WARNING</a></h2>
<p>This is for testing only!  Never ever use it in non-testing code.  Doing so
may compromise your security.</p>
<p>You may wish to use clippy’s <code>disallowed-methods</code> lint to ensure you aren’t
using it outside of your tests.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<p>Here’s a simple example, of a test that verifies that integer sorting works
correctly by shuffling a short sequence and then re-sorting it.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>tor_basic_utils::test_rng::testing_rng;
<span class="kw">use </span>rand::{seq::SliceRandom};
<span class="kw">let </span><span class="kw-2">mut </span>rng = testing_rng();

<span class="kw">let </span><span class="kw-2">mut </span>v = <span class="macro">vec!</span>[-<span class="number">10</span>, -<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];
v.shuffle(<span class="kw-2">&amp;mut </span>rng);
v.sort();
<span class="macro">assert_eq!</span>(<span class="kw-2">&amp;</span>v, <span class="kw-2">&amp;</span>[-<span class="number">10</span>, -<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</code></pre></div>
<p>Here’s a trickier example of how you might write a test to override the
default behavior.  (For example, you might want to do this if the test is
unreliable and you don’t have time to hunt down the issues.)</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>tor_basic_utils::test_rng::Config;
<span class="kw">let </span><span class="kw-2">mut </span>rng = Config::from_env()
    .unwrap_or(Config::Deterministic)
    .into_rng();</code></pre></div>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.TestingRng.html" title="struct tor_basic_utils::test_rng::TestingRng">TestingRng</a></div><div class="desc docblock-short">A cryptographically secure random number generator that uses the ChaCha algorithm.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Config.html" title="enum tor_basic_utils::test_rng::Config">Config</a></div><div class="desc docblock-short">Type describing a testing_rng configuration.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.testing_rng.html" title="fn tor_basic_utils::test_rng::testing_rng">testing_rng</a></div><div class="desc docblock-short">Return a new, possibly deterministic, RNG for use in tests.</div></li></ul></section></div></main></body></html>